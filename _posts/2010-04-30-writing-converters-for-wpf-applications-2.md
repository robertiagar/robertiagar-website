---
layout: post
title: Writing Converters for WPF applications
date: 2010-04-30 12:09
author: "Robert Iagar"
comments: true
tags: [WPF]
---
I’m currently writing my own Twitter client (yes, I know, another Twitter client will hit the market. Whoopee!) and I had to create a converter that turns a regular string to some kind of a rich text box with link’s and that kind of stuff. The algorithm is in my head just need to implement. That would be my greatest achievement yet. But let’s not go adrift from the subject. Writing your own converter for your app.<br /><br />First you need to know is your input and what would be your output (that’s essentially what a converter is: take some input, does some work with and then returns an output). WPF has some very basic converters built-in: String to Color, String to Bool and many more that I have no idea where there are or how they work. I know that the XAML parser uses converters a lot. Some WPF developer I am. But anyway. Let’s get to the point.<br /><br /><a name='more'></a><br /><br />In my application I have a TwitterViewModel that I bind all my data to it. One of the data that I bind to is a string that contains the status of a users tweet. That’s just the string, no hyperlinks or links to the User who wrote just a naked string. I need to write a converter that converts that string to a “rich text box” with hyperlinks, hashtags and al of the other stuff.<br /><br />I’m going to show how I got to use what I use and then hopefully you’ll understand how I did it. We won't be creating that rich-textbox because the code is fairly long and for new-comers can be a little complicated. I'm just going to show how to convert a string to a textblock and add some quick-tips along the way. So let’s begin:<br /><h2>Setting up your thing to convert</h2><br />At the beginnings I had the following TextBlock that is bind to the status of the TwitterViewModel:<br /><blockquote>&lt;TextBlock<br />Grid.Row="1"  Grid.Column="1" Grid.ColumnSpan="2"<br />TextWrapping=”Wrap”<br />Text="{Binding Status}"/&gt;</blockquote><br />Everything worked out peachy for test purposes but now the gig is up and I need to create the converter to make the status look and work better.<br /><br />Now it’s time to put your brain to work and think what you need to show and you have. I need to show a TextBlock with links for hyperlinks and hashtags.<br />Can it be done?<br />With this setup: No.<br />Why? Because you cannot set a Text property of a TextBlock to host any content other than a string. Well you can, but not in this format. You need to replace with either a ContentControl or something derived from ContentControl (e.i. a  Button or Label). I replaced the TextBlock with a Label and removed the TextWrapping property (because the Label does not support text wrapping) and changed the Text property to Content:<br /><blockquote>&lt;Label<br />Grid.Row="1"  Grid.Column="1" Grid.ColumnSpan="2"<br />Content="{Binding Status}"/&gt;</blockquote><br />Right everything works like before nothing fancy. Because a Label supports anything as a content as long as it’s one ContentItem that can be a ContentContainer (e.i Grid, DockPanel, StackPanel – which can host multiple content) we can now create our converter.<br /><h2>Setting up your converter</h2><br />Go into Visual C# Express 2010 and create a new Class in your project:<br /><br /><a href="http://robertiagar.files.wordpress.com/2010/04/image.png"><img title="image" src="http://robertiagar.files.wordpress.com/2010/04/image_thumb.png" border="0" alt="image" width="244" height="139" /></a><br /><br />Name it something easy to understand (i.e: TwitterStatusConverter) and not something generic (i.e. Converter). When others look at your code they need to understand what you did there and not ask you every time “Hey what does Convert_2.cs do?”<br /><br />Visual C# Express will automatically open your new class file. You should have something like this:<br /><br />using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br /><br />namespace Robert.Converters<br />{<br />class TestConverter<br />{<br />}<br />}<br /><br />Visual C# Express generated namespaces automatically with every source file you add into a folder. Robert is my main namespace and Converters is where I created the Class file. Depending on your setup you can have different results.<br />Now add the following usings:<br /><br />using System.Windows.Data;<br />using System.Windows.Controls;<br />using System.Windows.Documents;<br /><br />You’ll see in a moment why we need all those references.<br /><br />Now we need to derive our class from IValueConverter. IValueConverter is an interface that make creating converters easy:<br /><br />using System;<br />using System.Collections.Generic;<br />using System.Linq;<br />using System.Text;<br />using System.Windows.Data;<br />using System.Windows.Controls;<br />using System.Windows.Documents;<br /><br />namespace Robert.TwitBy.Converters<br />{<br />class TestConverter:IValueConverter<br />{<br />}<br />}<br /><br />Implement the interface:<br /><br /><a href="http://robertiagar.files.wordpress.com/2010/04/image1.png"><img title="image" src="http://robertiagar.files.wordpress.com/2010/04/image_thumb1.png" border="0" alt="image" width="244" height="139" /></a><br /><br />You should have the following methods:<br /><br />public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)<br />{<br />throw new NotImplementedException();<br />}<br /><br />public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)<br />{<br />throw new NotImplementedException();<br />}<br /><br />We’ll work with the Convert(…) method. Delete what’s in it and add the following code:<br /><br />string s = value as string;<br /><br />var textBlock = new TextBlock()<br />{<br />TextWrapping = System.Windows.TextWrapping.Wrap<br />};<br /><br />textBlock.Inlines.Add(s); //textblock.Inlines.Add() is powerful method. You can add whatever you want ( hyperlinks for example).<br /><br />return textBlock;<br /><br />The first line takes the <strong>value </strong>object and converts it into a string. Why is <strong>value</strong> an object? Simple. The object type is one or the most versatile types in C# (learned this from <a href="http://twitter.com/Pete_Brown">Pete_Brown</a>).<br />The second line creates a textBlock with it’s TextWrapping Property set to Wrap (System.Windows.TextWrapping.Wrap is the full path to the TextWrapping enum).<br />The third adds the string to the textBlock inline collection and then returns the textBlock.<br />Basically we’ve create a String to TextBlock converter. Nothing fancy but you should understand how converters work.<br /><h2>Adding the converter to your binding expression</h2><br />First of all you need to create a reference in your xaml file to your converter.<br /><br />xmlns:c="clr-namespace:Robert.TwitBy.Converters"<br /><br />Or depending what namespace is your converter in. Usually you add these references in you Document root (i.e. Window, Application).<br /><br />Now in your ResourcesDictionary , where you want to use the converter create a key for it.<br /><br /><br /><br />Remember when we wrote our label with our binding expression? Let me remind you:<br /><br />&lt;Label<br />Grid.Row="1"  Grid.Column="1" Grid.ColumnSpan="2"<br />Content="{Binding Status}"/&gt;<br /><br />Change the Content property binding like so:<br /><br />&lt;Label<br />Grid.Row="1"  Grid.Column="1" Grid.ColumnSpan="2"<br /><strong>Content="{Binding Status, Converter={StaticResource TestConverter}}"</strong>/&gt;<br /><br />That’s about it. Now it should convert your string to a TextBlock.
